package cc.unknown.module.impl.exploit.disablers;

import cc.unknown.event.Listener;
import cc.unknown.event.annotations.EventLink;
import cc.unknown.event.impl.other.TeleportEvent;
import cc.unknown.event.impl.player.PreMotionEvent;
import cc.unknown.module.impl.exploit.Disabler;
import cc.unknown.util.chat.ChatUtil;
import cc.unknown.util.packet.PacketUtil;
import cc.unknown.value.Mode;
import net.minecraft.network.play.client.C03PacketPlayer;
import net.minecraft.util.AxisAlignedBB;

public class NoRulesDisabler extends Mode<Disabler> {

    private boolean started, teleport;

    public NoRulesDisabler(String name, Disabler parent) {
        super(name, parent);
    }

    @EventLink()
    public final Listener<TeleportEvent> onTeleport = event -> {
        if (teleport) {
            event.setCancelled(true);
            teleport = false;
            ChatUtil.display("Turn off disabler module once this message shows up");
        }
    };

    @EventLink()
    private final Listener<PreMotionEvent> preMotionEventListener = event -> {
        final AxisAlignedBB bb = mc.player.getEntityBoundingBox().offset(0, 1, 0);

        if (started) {
            mc.player.motionY += 0.025;
        }
        if (mc.world.getCollidingBoundingBoxes(mc.player, bb).isEmpty() && !started) {
            started = true;
            mc.player.jump();
            PacketUtil.send(new C03PacketPlayer.C06PacketPlayerPosLook(mc.player.posX, mc.player.posY - 0.1, mc.player.posZ, mc.player.rotationYaw, mc.player.rotationPitch, false));
            teleport = true;
        }
    };

    @Override
    public void onEnable() {
        started = false;
        teleport = false;
    }
}

